# 6장. 응용 서비스와 표현영역

## 6.1 표현 영역과 응용 영역
- 사용자와 도메인을 연결해 주는 역할을 하는 것이 응용 영역과 표현 영역이다.
- 응용 서비스의 메서드가 요구하는 파라미터와 표현 영역이 전달받은 데이터는 일치하지 않을 수 있다. 이런 경우 표현 영역은 응용 영역이
  요구하는 객체나 데이터를 생성한 뒤 응용 영역의 메소드를 호출한다.

## 6.2 응용 서비스의 역할
- 응용 서비스의 주요 역할은 도메인 객체를 사용해서 사용자의 요청을 처리하는 것으로 표현 영역의 입장에서 보면 응용 서비스는
  도메인 영역과 표현 영역을 연결해주는 창구 역할을 한다.
- 응용 서비스가 복잡하다면 응용 서비스에서 도메인 로직의 일부를 구현할 가능성이 높다. 응용 서비스가 도메인 로직을 일부 구현하면
  코드 중복, 로직 분산 등 코드 품질에 안 좋은 역할을 미친다.
- 도메인의 상태나 값을 체크하는 것은 도메인의 핵심 로직이기 때문에 다음 코드처럼 응용 서비스에서 이 로직을 구현하면 안 된다.
```java
public class ChangePasswordService {
    public void changePassword(String memberId, String oldPw, String newPw) {
        Member member = memberRepository.findById(memberId);
        if (!passwordEncoder.matched(oldPw, newPw)) {
            throw new IllegalArgument();
        }
        member.changePassword();
    }
}
```
- 도메인 로직을 도메인 영역과 응용 서비스에 분산해서 구현하면 여러 응용 서비스에서 동일한 도메인 로직을 구현할 가능성이 높아진다.
  애초에 도메인 영역에 암호확인 기능을 구현하면 응용 서비스는 그 기능을 사용하기만 하면 된다.

## 6.3 응용 서비스의 구현
- 응용 서비스는 표현 영역과 도메인 영역을 연결하는 매개체 역할을 하는데 이는 마치 디자인 패턴의 파사드와 같은 역할을 한다.
- 응용 서비스는 크게 다음 두 가지 방법 중 한 가지 방식으로 구현한다.
  - 한 응용 서비스에 도메인의 모든 기능 구현하기
  - 구분되는 기능별로 응용 서비스를 여러개 구현하기
- 위의 예시에서 한 응용 서비스에 모든 기능을 구현한다는 것은 회원가입/수정/조회/삭제 등의 기능을 한 서비스에 구현한다는 뜻이다.
  - 이는 코드 중복을 제거하기 쉬운 장점이 있지만 코드 크기가 커지면 연관성이 적은 클래스가 함께 위치할 가능성이 많아진다.
  - 또한 한 클래스에 코드가 모이기 시작하면 엄연히 분리하는게 좋은 상황임에도 습관적으로 기존에 존재하는 클래스에 코드를 끼워 넣게 된다.
- 구분되는 기능별로 서비스를 구현하면 클래스 개수는 많아지지만 코드 품질을 일정 수준으로 유지하는데 도움이 된다. 각 기능마다 동일한 로직을
  구현할 경우(존재하는 도메인을 찾는 경우) Helper 클래스에 로직을 구현해서 코드가 중복되는 것을 방지할 수 있다.

### 6.3.2 응용 서비스와 인터페이스
- 인터페이스가 필요한 몇 가지 상황이 있는데 그 중 하나는 구현 클래스가 여러개인 경우다. 구현 클래스가 다수 존재하거나
  런타임에 구현 객체를 교체해야 할 때 인터페이스를 유용하게 사용할 수 있다.
- 하지만 응용 서비스는 런타임에 교체하는 경우는 거의 없고 한 응용 서비스의 구현 클래스가 두 개인 상황도 드물다.
- 인터페이스와 클래스를 따로 구현하면 소스 파일만 많아지고 간접 참조가 증가한다. 따라서 인터페이스가 확실하게 필요하기 전까진
  응용 서비스에 대한 인터페이스를 작성하는 것이 좋은 선택은 아니다.

### 6.3.3 메서드 파라미터 값 리턴
- 응용 서비스는 표현 영역으로 부터 개별 파라미터를 전달받을 수도 있고 별도의 데이터 클래스를 전달받을 수도 있다. 응용 서비스에
  데이터로 전달할 요청 파라미터가 두 개 이상 존재하면 데이터 전달을 위한 별도 클래스를 사용하는 것이 편리하다.

## 6.4 표현 영역
- 표현 영역의 책임은 크게 다음과 같다.
  - 사용자가 시스템을 사용할 수 있는 화면을 제공한다. 사용자는 표현 영역이 제공하는 폼에 알맞은 값을 입력하고 폼을 표현 영역에 전송한다.
  - 사용자의 요청에 맞게 응용 서비스에 필요한 데이터를 전달하고 반환한다. 정상적인 처리 외에도 응용 서비스에서 예외가 발생하면 에러 코드를
    설정하는데 표현 영역의 뷰는 이 에러에 따른 알맞은 처리(메시지 출력 같은)를 하게 된다.

## 6.5 값 검증
- 값 검증은 표현 영역과 응용 서비스 두 곳에서 처리가 가능하지만 원천적으로 모든 값의 검증은 응용 서비스에서 처리한다.
- 실무에선 주로 표현 영역과 응용 서비스가 값 검사를 나눠서 수행한다.
  - 표현 영역은 필수 값, 값의 형식, 범위 등을 검증
  - 응용 서비스는 데이터의 존재 유무와 같은 논리적 오류를 검증

## 6.7 조회 전용 기능과 응용 서비스
- 서비스에서 아래와 같이 단순히 조회 전용 기능을 리턴한다면 트랜잭션이 필요하지도 않다. 이런 경우 굳이 서비스를 만들 필요 없이
  **표현 영역에서 바로 조회 전용 기능을 사용**해도 **문제가 없다**.
```java
public class AService {
    public List<A> getAList(String id) {
        return aDao.selectAll(id);
  }
}

public class AController {
  @RequestMapping("/a")
  public List<A> getAList() {
    // id 구함
    return aDao.selectAll(id);
  }
}
```
- 응용 서비스를 항상 만들었던 개발자는 컨트롤러에서 응용 서비스 없이 조회 전용 기능에 접근하는게 이상하게 느껴질 수 있다.
  하지만 응용 서비스가 사용자 요청 기능을 실행하는데 별다른 기여를 하지 못한다면 굳이 서비스를 만들지 않아도 된다.
