# 애그리거트 

## 도메인 모델링이란?
- 도메인 모델링이란 비즈니스 로직을 표현하는 것이다. 
- 비즈니스 로직을 모델링하면 이해관계자들 사이에서 커뮤니케이션과 작업이 용이해지고, 유지보수가 쉬워진다.

## 도메인 모델링의 구성요소
- 엔티티: 식별자를 가진 객체, 고유하게 식별 가능하며 생명 주기를 갖는다.
- 밸류: 엔티티에 속하는 객체로 고유한 식별자를 갖지 않으며, 엔티티 생명주기에 종속된다.
- 애그리게잇: 관련된 엔티티와 밸류의 모음, 하나의 루트 엔티티와 그 엔티티에 속한 밸류들로 구성된다.
- 리포지토리: 애그리게잇의 영속화와 조회를 담당한다.
- 서비스: 특정 애그리게잇에 속하지 않는 도메인 로직을 처리한다.
- 도메인 이벤트: 도메인에서 발생하는 중요한 사건, 도메인 모델의 상태 변경 등을 나타낸다.
- 무결성 규칙: 도메인에서 지켜져야 하는 제약 조건을 의미한다.
## 도메인 모델링의 구현
- 도메인 모델링의 구현은 객체지향 언어를 이용하는 것이 적합하다. 
- 적절한 패턴과 객체지향 설계 원칙을 사용하면 도메인 모델링을 효과적으로 구현할 수 있다.

이상 ChatGPT에게 문의한 내용이다.
---

## 애그리거트를 나누는 기준 ?
- 이 책에서 설명하는 애그리거트 나누는 기준은 `생명주기`, `데이터발생주체` 위주로 이야기하고 있다.
- 주문이라는 도메인은 주문한정보, 회원의 배송정보 등이 필요하여 Order의 애그리거트엔 OrderLine, ShippingInfo가 포함된다.
- 다만 흥미로운 점은 `상품`과 `리뷰`를 분리한 점인데, 비슷한 유형으로 보이지만,    
  `생성주기`가 상이하며, 데이터 생성하는 주체가 `상품담당자`와 `상품구매자`로 상이하여 다른 애그리거트로 묶었다.

## 어떻게하면 리스크를 낮추고 애그리거트를 구현할까 ?
- 불볍객체를 활용하는 것을 강조
- 다른 애그리거트의 데이터를 변경하는 행위가 필욜할 때 직접적으로 변경하는 것이 아닌, 중간 응용서비스를 구성해 처리(의존성 역전과 유사해보임)
- 이 책에선 다른 애그리거트를 직접 참조하는 것이 아닌 Id(Key) 값으로 조회하는 것을 추천
- Order 엔티티에서 Member member 와 같이 직접 참조를 한다면, member를 Order 애그리거트에서 수정하는 사항이 발생할 수 있다.

## 성능이슈(N+1, 1-N 연관관계)와 확장성
- 무조건 답은 없지만 대체로 1-N 연관관계보다는 N-1 연관관계 매핑을 하는 설계를 추천하고 있다.
  - 1-N은 한개의 엔티티가 여러개의 엔티티를 참조하는 것을 로딩하지만, N-1은 다수의 엔티티에서 하나의 엔티티만 참조해서 가져올 수 있다.
- N+1 문제는 지연로딩, 즉시로딩으로 가이드를 주는데, 보고서 같은 케이스는 즉시로딩, 이외는 JPQL 활용하는 방법으로 가이드하고 있다.

## 팩토리메서드 활용
